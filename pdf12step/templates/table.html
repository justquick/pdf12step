{% extends 'layout.html' %}
{% import 'macros.html' as macros with context %}
{% block head %}
<style>
@font-face {
    font-family: Fira Sans;
    font-weight: 500;
    src: url(http://fonts.gstatic.com/s/firasans/v11/va9E4kDNxMZdWfMOD5VfkILKSTbndQ.ttf);
}

@font-face {
    font-family: Fira Sans;
    font-style: italic;
    font-weight: 500;
    src: url(http://fonts.gstatic.com/s/firasans/v11/va9f4kDNxMZdWfMOD5VvkrA6Qhf_XljGllLX.ttf);
}

@font-face {
    font-family: Fira Sans;
    font-style: italic;
    font-weight: 300;
    src: url(http://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnPKruQR37fF3Wlg.ttf);
}

@font-face {
    font-family: Fira Sans;
    font-weight: 700;
    src: url(http://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnLK3uQR37fF3Wlg.ttf);
}

h1,h3 {
  text-align: center;
}
html {
  font-family: Fira Sans;
}
  @page {
    size: 14in 8.5in;
    font-size: 12pt;
    font-family: Fira Sans;
    margin: 1.5cm .5cm .5cm .5cm;
  }

  .f28 {
    font-size: 28pt;
  }

  .f20 {
    font-size: 20pt;
  }
  .f14 {
    font-size: 14pt;
  }
  .b {
    font-weight: bold;
  }
  .bordered table,
  .bordered th,
  .bordered td {
    border: 1px solid;
  }

  th {
    text-align: center;
  }

  tr {
    page-break-inside: avoid;
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }

  .meetname {
    font-weight: bold;
    font-size: 11pt;
  }

  .meetcols {
    font-size: 10pt;
    width: 10%;
  }

  .meettypes {
    font-size: 7pt;
  }
  .address, .location {
    font-size: 10pt
  }
  .section {
    background: {{ config.header_color }};
    color: {{ config.page_number_color }};
    text-align: center;
    font-weight: bold;
  }
</style>
{% endblock %}
{% block body %}

<table>
<tr>
<td>
<a href="{{ config.qrcode_url }}"><img src="{{ qrcode }}" /></a>


</td>

<td  style="text-align: center; width: 70%;">

<span class="f28 b">{{ config.author }}</span><br/>
<span class="f14">{{ config.address }}</span><br/>
<span class="f20 b">{{ now.strftime('%B %Y') }} Directory</span>
</td>

<td style="text-align: right; ">
Email: {{ config.email }}<br/>
Phone: {{ config.phone }}<br/>
<b><i>Last updated: {{ now.strftime('%Y-%m-%d') }}</i></b>
</td>
</tr>

<tr>
<td colspan="3">
{% for code, name in filtered_codes %}
    <b>{{ code }}</b>={{ name }},
{% endfor %}
</td>
</tr>
</table>

<table class="bordered">
  <tr>
    <th>Meeting</th>
    <th>Sunday</th>
    <th>Monday</th>
    <th>Tuesday</th>
    <th>Wednesday</th>
    <th>Thursday</th>
    <th>Friday</th>
    <th>Saturday</th>
    <th>Conference</th>
  </tr>

{% for name1, group1 in meetings.by_value('region_display', sort=True) %}
  <tr class="section">
      <td colspan="9">
          <span class="sectiontitle">&nbsp;{{ name1 }}</span>
          {% set zips = zipcodes_by_region[name1] %}
          {% if not zips %}
            {% set zips = group1.zipcodes %}
            {% endif %}
              {{ zips|join(',') }}
      </td>
  </tr>
  {% for name, meets in group1.by_value('name').items()|sort %}
  {% set first = meets[0] %}
  <tr>
    <td class="firstcol">
      <span class="meetname">{{ macros.title(first) }}</span><br />
      <span class="location">{% if first.location %}{{ macros.location(first) }}</span><br />{% endif %}
      <span class="address">{{ macros.address_link(first) }}</span>
    </td>
    {% set daymeets = meets.by_value('day') %}
    {% for day, dayname in DAYS.items()| sort %}
    {% if day != 12 %}
    <td class="meetcols">
      {% if daymeets[day] %}
      {% for meet in daymeets[day] %}
      <span class="time">{{ meet.time_display }}</span> <span class="meettypes">({{ macros.codes(meet, ', ') }})</span><br>
      {% endfor %}
      {% endif %}
    </td>
    {% endif %}
    {% endfor %}
    <td class="meetcols">
    {{ macros.zoom_link(first) }} <br/>
    {{ macros.phone_link(first) }} <br/>
    </td>
  </tr>
  {% endfor %}

{% endfor %}
{% endblock %}

{% extends 'layout.html' %}
{% import 'macros.html' as macros with context %}

{% block head %}
<style>
  @font-face {
      font-family: Fira Sans;
      font-weight: 500;
      src: url(http://fonts.gstatic.com/s/firasans/v11/va9E4kDNxMZdWfMOD5VfkILKSTbndQ.ttf);
  }

  @font-face {
      font-family: Fira Sans;
      font-style: italic;
      font-weight: 500;
      src: url(http://fonts.gstatic.com/s/firasans/v11/va9f4kDNxMZdWfMOD5VvkrA6Qhf_XljGllLX.ttf);
  }

  @font-face {
      font-family: Fira Sans;
      font-style: italic;
      font-weight: 300;
      src: url(http://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnPKruQR37fF3Wlg.ttf);
  }

  @font-face {
      font-family: Fira Sans;
      font-weight: 700;
      src: url(http://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnLK3uQR37fF3Wlg.ttf);
  }
  @page {
      size: {{ config.size }};
      margin: 0;
     display: flex;
     overflow-wrap: normal;
  }
  html {
      font-family: Fira Sans;
      font-weight: 500;
  }
  h1 {
    font-size: 2em;
  }
  h4,hr {
    margin: 0;
  }
  .cover {
    text-align: center;
  }

  .group1header {
    text-align: center;
    background: {{ config.header_color }};
    color: {{ config.page_number_color }};
  }
  .contact {
    font-weight: bold;
  }
  .columns  {
    columns: 3;
    page-break-after: always;
  }
  table {
      width: 100%;
      border-collapse: collapse;
  }

  .timecol {
    font-size: .9em;
    width: 8ch;
  }
  .meetings {
    font-size: .8em;
  }

  .meetname {
    font-weight: bold;
  }

  table td{
    vertical-align: top;
      border-bottom: 1px solid lightgrey;
      padding-bottom: 3px;
  }
  .innertable {
    border-collapse: collapse;
  border-style: hidden;
  }
  .innertable td {
     page-break-inside: avoid;
  }
  .ntable {
    break-before: always;
    page-break-inside: avoid;
    height: 8.5in;
  }
</style>
{% endblock %}

{% block body %}
<div class="columns">

  <section class="cover">
    <h1>{{ config.author }}</h1>
    <p>{{ config.address }}<br /><b>{{ now.strftime('%B %Y') }} Directory</b></p>
    <p><i>Last updated: {{ now.strftime('%d/%m/%Y') }}</i></p>

    <a href="{{ config.qrcode_url }}"><img src="{{ qrcode }}" /></a>

    <p class="contact">
      {{ config.email }}<br />
      {{ config.phone }}
    </p>
    <hr />
    <p class="codes">
      {% for code, name in filtered_codes %}
      <b>{{ code }}</b>={{ name }},
      {% endfor %}
    </p>
  </section>

{% for name1, group1 in meetings.by_value('day', sort=True) %}

{% if config.group1_header %}
  <div class="group1header">
    <h4>{{ DAYS[name1|int] }}</h4>
  </div>
{% endif %}
<section>
  <table>
  {% for time, meets in group1.by_value('time').items()|sort %}
    <tr >
        <td class="timecol">{{ meets[0].time_display }}</td>
        <td class="meetings">
          <table class="innertable">
          {% for meet in meets %}
          <tr ><td>
            <span class="meetname">{{ macros.title(meet) }}</span>
            <span class="meettypes">({{ macros.codes(meet, ', ') }})</span><br>
            {% if meet.notes %}<span class="notes">{{ meet.notes_list|join('|') }}</span><br/>{% endif %}
            <span class="location">{% if meet.location %}{{ macros.location(meet) }}</span><br />{% endif %}
            <span class="address">{{ macros.address_link(meet) }}</span>
          </td></tr>
          {% endfor %}
        </table>
        </td>
      </tr>
  {% endfor %}
</table>
</section>
{% endfor %}
  <section class="ntable">
    <table >
      {% for i in range(32) %}
      <tr>
        <td>&nbsp;</td>
      </tr>
      {% endfor %}
    </table>
  </section>
</div>

{% endblock %}
